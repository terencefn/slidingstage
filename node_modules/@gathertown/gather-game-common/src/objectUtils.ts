import { WireObject } from "./public/events";
import { MapObject } from "./public/gameMap";

export function parseObjCustomState<T>(obj: MapObject | WireObject): T | null {
  const state = obj?.customState;
  if (state) {
    try {
      return JSON.parse(state);
    } catch (e) {
      console.log("error getting custom state");
    }
  }
  return null;
}

// this applies to copying spawn id, private space id, desk id, etc.
export const generateNewId = (currId: string, idList: string[]): string => {
  const digitsAtEndMatch = currId.match(/\d+$/);
  let newId: string;
  if (digitsAtEndMatch && digitsAtEndMatch[0]) {
    const indexOfDigits = currId.indexOf(digitsAtEndMatch[0]);
    newId = currId.substring(0, indexOfDigits) + (parseInt(digitsAtEndMatch[0], 10) + 1);
  } else {
    newId = currId + "-2";
  }

  if (idList.includes(newId)) {
    return generateNewId(newId, idList);
  } else {
    return newId;
  }
};
